---
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import { buildBlogPostingJsonLd } from "../../utils/structuredData";

export const prerender = true;

type ArticleData = {
  title: string;
  href: string;
  image?: string | null;
  publishedAt?: string | null;
  updatedAt?: string | null;
  authorName?: string | null;
};

export async function getStaticPaths() {
  const articles = await getCollection("articles");
  const paths = articles
    .map((a) => {
      const href = String(a.data.href ?? "").trim();
      const m = href.match(/^\/article\/([^/?#]+)\/?$/);
      const slug = m?.[1] ?? null;
      if (!slug) return null;
      return { params: { slug }, props: { article: a.data } };
    })
    .filter(Boolean) as { params: { slug: string }; props: { article: ArticleData } }[];

  return paths;
}

const { article } = Astro.props as { article: ArticleData };
const siteUrl = Astro.site ? new URL(Astro.site) : new URL(Astro.url.origin);
const canonical = new URL(Astro.url.pathname, siteUrl).toString();
const tldr =
  `TL;DR: ${article.title}の要点を、結論→理由→具体例の順で短くまとめます。時間がない場合はこの段落だけで概要を把握できます。`;

const jsonLd = buildBlogPostingJsonLd({
  canonicalUrl: canonical,
  siteUrl,
  title: article.title,
  publishedAt: article.publishedAt ?? null,
  updatedAt: article.updatedAt ?? null,
  imageUrl: article.image ?? null,
  authorName: article.authorName ?? null,
  description: `${article.title}｜eigoonline`,
});
---

<Layout title={article.title} description={`${article.title}｜eigoonline`}>
  <Fragment slot="head">
    <script type="application/ld+json" set:html={JSON.stringify(jsonLd)} />
  </Fragment>

  <main class="mx-auto w-full max-w-3xl px-4 pb-14 pt-10">
    <header class="rounded-2xl border border-zinc-200 bg-white p-6 shadow-sm">
      <h1 class="text-2xl font-extrabold text-zinc-900">{article.title}</h1>
      <div class="mt-3 rounded-xl bg-amber-50 p-4 ring-1 ring-amber-200">
        <div class="text-[11px] font-extrabold tracking-wide text-amber-800">TL;DR</div>
        <p class="mt-1 text-sm font-semibold leading-relaxed text-amber-950">{tldr}</p>
      </div>
      <div class="mt-3 flex flex-wrap items-center gap-x-4 gap-y-1 text-xs font-semibold text-zinc-600">
        <span>著者：{article.authorName ?? "eigoonline編集部"}</span>
        {article.publishedAt ? <span>公開：{article.publishedAt}</span> : null}
        {article.updatedAt ? <span>更新：{article.updatedAt}</span> : null}
      </div>
      {article.image ? (
        <div class="mt-4 overflow-hidden rounded-xl ring-1 ring-zinc-200">
          <img
            src={article.image}
            alt={`${article.title} アイキャッチ`}
            loading="lazy"
            decoding="async"
            class="h-auto w-full object-cover"
          />
        </div>
      ) : null}
    </header>

    <section class="mt-6 rounded-2xl border border-zinc-200 bg-white p-6 shadow-sm">
      <h2 class="text-lg font-extrabold text-zinc-900">この記事の結論は？</h2>
      <p class="mt-2 text-sm font-semibold text-zinc-700">準備中です。公開までしばらくお待ちください。</p>

      <h2 class="mt-6 text-lg font-extrabold text-zinc-900">どんな人が読むべき？</h2>
      <p class="mt-2 text-sm font-semibold text-zinc-700">
        オンライン英会話を比較検討していて、料金・無料体験・続けやすさのポイントを短時間で把握したい人向けです。
      </p>

      <h2 class="mt-6 text-lg font-extrabold text-zinc-900">チェックすべきポイントは？</h2>
      <ul class="mt-2 list-disc space-y-1 pl-5 text-sm font-semibold text-zinc-700">
        <li>料金（最安/月額の目安）</li>
        <li>無料体験（期間・回数）</li>
        <li>受講できる時間帯・予約のしやすさ</li>
        <li>教材・講師・学習サポート</li>
      </ul>

      <h2 class="mt-6 text-lg font-extrabold text-zinc-900">次に何をすればいい？</h2>
      <p class="mt-2 text-sm font-semibold text-zinc-700">
        まずは目的に合うランキングから候補を絞り、公式サイトで最新条件を確認して無料体験で相性をチェックするのがおすすめです。
      </p>
      <div class="mt-5">
        <a class="btn-brand inline-flex items-center rounded-xl px-4 py-2 text-sm font-extrabold text-white" href="/">
          TOPへ戻る
        </a>
      </div>
    </section>
  </main>
</Layout>

