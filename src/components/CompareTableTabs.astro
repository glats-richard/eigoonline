---
import CTAButton from "./CTAButton.astro";
import StarRating from "./StarRating.astro";
import CompareTable from "./CompareTable.astro";

type School = {
  name: string;
  logoUrl?: string | null;
  officialUrl: string;
  rating?: number | null;
  priceText?: string | null;
  hoursText?: string | null;
  trialText?: string | null;
  points?: string[];
  recommendedFor?: string[];
};

type Ranking = {
  title: string;
  items: { id: string; data: School }[];
};

type Props = {
  overall: Ranking;
  exam: Ranking;
  daily: Ranking;
  business: Ranking;
  /** How many columns to show in compare table */
  columns?: number;
};

const { overall, exam, daily, business, columns = 4 } = Astro.props satisfies Props;

const sliceCols = (r: Ranking, n: number) => ({ ...r, items: r.items.slice(0, n) });
const desktopCols = columns;
// Show up to 4 columns on mobile as well (horizontal scroll enabled in table).
const mobileCols = Math.min(4, columns);

const oMobile = sliceCols(overall, mobileCols);
const eMobile = sliceCols(exam, mobileCols);
const dMobile = sliceCols(daily, mobileCols);
const bMobile = sliceCols(business, mobileCols);

const oDesktop = sliceCols(overall, desktopCols);
const eDesktop = sliceCols(exam, desktopCols);
const dDesktop = sliceCols(daily, desktopCols);
const bDesktop = sliceCols(business, desktopCols);
---

<section class="min-w-0 rounded-2xl border-2 border-[#F49BB5] bg-white p-0 shadow-sm overflow-hidden">
  <input class="peer/ct-overall sr-only" type="radio" name="comparetab" id="ct-overall" checked />
  <input class="peer/ct-exam sr-only" type="radio" name="comparetab" id="ct-exam" />
  <input class="peer/ct-daily sr-only" type="radio" name="comparetab" id="ct-daily" />
  <input class="peer/ct-business sr-only" type="radio" name="comparetab" id="ct-business" />

  <div class="rounded-t-2xl bg-[#ecf9fe] px-3 pt-3 sm:px-4
    peer-checked/ct-overall:[&_.tab-overall]:relative peer-checked/ct-overall:[&_.tab-overall]:z-10 peer-checked/ct-overall:[&_.tab-overall]:h-full peer-checked/ct-overall:[&_.tab-overall]:bg-[linear-gradient(to_bottom,#EE6B95,#F49BB5_55%,#fff_100%)] peer-checked/ct-overall:[&_.tab-overall]:text-white peer-checked/ct-overall:[&_.tab-overall]:shadow-[0_2px_8px_rgba(0,0,0,0.18)]
    peer-checked/ct-exam:[&_.tab-exam]:relative peer-checked/ct-exam:[&_.tab-exam]:z-10 peer-checked/ct-exam:[&_.tab-exam]:h-full peer-checked/ct-exam:[&_.tab-exam]:bg-[linear-gradient(to_bottom,#EE6B95,#F49BB5_55%,#fff_100%)] peer-checked/ct-exam:[&_.tab-exam]:text-white peer-checked/ct-exam:[&_.tab-exam]:shadow-[0_2px_8px_rgba(0,0,0,0.18)]
    peer-checked/ct-daily:[&_.tab-daily]:relative peer-checked/ct-daily:[&_.tab-daily]:z-10 peer-checked/ct-daily:[&_.tab-daily]:h-full peer-checked/ct-daily:[&_.tab-daily]:bg-[linear-gradient(to_bottom,#EE6B95,#F49BB5_55%,#fff_100%)] peer-checked/ct-daily:[&_.tab-daily]:text-white peer-checked/ct-daily:[&_.tab-daily]:shadow-[0_2px_8px_rgba(0,0,0,0.18)]
    peer-checked/ct-business:[&_.tab-business]:relative peer-checked/ct-business:[&_.tab-business]:z-10 peer-checked/ct-business:[&_.tab-business]:h-full peer-checked/ct-business:[&_.tab-business]:bg-[linear-gradient(to_bottom,#EE6B95,#F49BB5_55%,#fff_100%)] peer-checked/ct-business:[&_.tab-business]:text-white peer-checked/ct-business:[&_.tab-business]:shadow-[0_2px_8px_rgba(0,0,0,0.18)]
  ">
    <div class="grid h-[50px] w-full grid-cols-4 items-end gap-0.5 text-[#595959] sm:gap-[10px]">
      <label
        for="ct-overall"
        class="tab tab-overall w-full cursor-pointer rounded-t-xl bg-[#d1d1d1] px-1.5 py-1 text-center text-[11px] font-extrabold leading-tight transition hover:bg-zinc-200 sm:px-3 sm:text-sm"
      >
        <div class="grid h-[80%] place-items-center">
          <span class="grid grid-rows-2 leading-tight">
            <span class="block">{overall.title}</span>
            <span class="block select-none text-transparent" aria-hidden="true">英会話</span>
          </span>
        </div>
      </label>
      <label
        for="ct-exam"
        class="tab tab-exam w-full cursor-pointer rounded-t-xl bg-[#d1d1d1] px-1.5 py-1 text-center text-[11px] font-extrabold leading-tight transition hover:bg-zinc-200 sm:px-3 sm:text-sm"
      >
        <div class="grid h-[80%] place-items-center">
          <span class="grid grid-rows-2 leading-tight">
            <span class="block">試験</span>
            <span class="block">対策</span>
          </span>
        </div>
      </label>
      <label
        for="ct-daily"
        class="tab tab-daily w-full cursor-pointer rounded-t-xl bg-[#d1d1d1] px-1.5 py-1 text-center text-[11px] font-extrabold leading-tight transition hover:bg-zinc-200 sm:px-3 sm:text-sm"
      >
        <div class="grid h-[80%] place-items-center">
          <span class="grid grid-rows-2 leading-tight">
            <span class="block">日曜</span>
            <span class="block">英会話</span>
          </span>
        </div>
      </label>
      <label
        for="ct-business"
        class="tab tab-business w-full cursor-pointer rounded-t-xl bg-[#d1d1d1] px-1.5 py-1 text-center text-[11px] font-extrabold leading-tight transition hover:bg-zinc-200 sm:px-3 sm:text-sm"
      >
        <div class="grid h-[80%] place-items-center">
          <span class="grid grid-rows-2 leading-tight">
            <span class="block">ビジネス</span>
            <span class="block">英会話</span>
          </span>
        </div>
      </label>
    </div>
  </div>

  <div class="px-3 pb-3 pt-4 sm:px-4 sm:pb-4 hidden peer-checked/ct-overall:block">
    <div class="sm:hidden">
      <CompareTable ranking={oMobile} variant="stack" />
    </div>
    <div class="hidden sm:block">
      <CompareTable ranking={oDesktop} variant="table" />
    </div>
  </div>
  <div class="px-3 pb-3 pt-4 sm:px-4 sm:pb-4 hidden peer-checked/ct-exam:block">
    <div class="sm:hidden">
      <CompareTable ranking={eMobile} variant="stack" />
    </div>
    <div class="hidden sm:block">
      <CompareTable ranking={eDesktop} variant="table" />
    </div>
  </div>
  <div class="px-3 pb-3 pt-4 sm:px-4 sm:pb-4 hidden peer-checked/ct-daily:block">
    <div class="sm:hidden">
      <CompareTable ranking={dMobile} variant="stack" />
    </div>
    <div class="hidden sm:block">
      <CompareTable ranking={dDesktop} variant="table" />
    </div>
  </div>
  <div class="px-3 pb-3 pt-4 sm:px-4 sm:pb-4 hidden peer-checked/ct-business:block">
    <div class="sm:hidden">
      <CompareTable ranking={bMobile} variant="stack" />
    </div>
    <div class="hidden sm:block">
      <CompareTable ranking={bDesktop} variant="table" />
    </div>
  </div>
</section>

