---
import CTAButton from "./CTAButton.astro";
import StarRating from "./StarRating.astro";
import CompareTable from "./CompareTable.astro";

type School = {
  name: string;
  logoUrl?: string | null;
  officialUrl: string;
  rating?: number | null;
  priceText?: string | null;
  hoursText?: string | null;
  trialText?: string | null;
  points?: string[];
  recommendedFor?: string[];
};

type Ranking = {
  title: string;
  items: { id: string; data: School }[];
};

type Props = {
  overall: Ranking;
  daily: Ranking;
  business: Ranking;
  /** How many columns to show in compare table */
  columns?: number;
};

const { overall, daily, business, columns = 4 } = Astro.props satisfies Props;

const sliceCols = (r: Ranking, n: number) => ({ ...r, items: r.items.slice(0, n) });
const desktopCols = columns;
// Show up to 4 columns on mobile as well (horizontal scroll enabled in table).
const mobileCols = Math.min(4, columns);

const oMobile = sliceCols(overall, mobileCols);
const dMobile = sliceCols(daily, mobileCols);
const bMobile = sliceCols(business, mobileCols);

const oDesktop = sliceCols(overall, desktopCols);
const dDesktop = sliceCols(daily, desktopCols);
const bDesktop = sliceCols(business, desktopCols);
---

<section class="min-w-0 rounded-2xl border border-zinc-200 bg-white p-3 shadow-sm sm:p-4 overflow-hidden">
  <input class="peer/ct-overall sr-only" type="radio" name="comparetab" id="ct-overall" checked />
  <input class="peer/ct-daily sr-only" type="radio" name="comparetab" id="ct-daily" />
  <input class="peer/ct-business sr-only" type="radio" name="comparetab" id="ct-business" />

  <div class="grid h-[50px] w-full grid-cols-3 items-end gap-0.5 bg-[#ecf9fe] px-[2%] text-zinc-600 sm:gap-[10px]
    peer-checked/ct-overall:[&_.tab-overall]:h-full peer-checked/ct-overall:[&_.tab-overall]:bg-[linear-gradient(to_top,#FFFF0D,#FFFFA3_10%,#FFFFA3_100%)] peer-checked/ct-overall:[&_.tab-overall]:text-zinc-900 peer-checked/ct-overall:[&_.tab-overall]:shadow-[0_2px_8px_rgba(0,0,0,0.18)]
    peer-checked/ct-daily:[&_.tab-daily]:h-full peer-checked/ct-daily:[&_.tab-daily]:bg-[linear-gradient(to_top,#FFFF0D,#FFFFA3_10%,#FFFFA3_100%)] peer-checked/ct-daily:[&_.tab-daily]:text-zinc-900 peer-checked/ct-daily:[&_.tab-daily]:shadow-[0_2px_8px_rgba(0,0,0,0.18)]
    peer-checked/ct-business:[&_.tab-business]:h-full peer-checked/ct-business:[&_.tab-business]:bg-[linear-gradient(to_top,#FFFF0D,#FFFFA3_10%,#FFFFA3_100%)] peer-checked/ct-business:[&_.tab-business]:text-zinc-900 peer-checked/ct-business:[&_.tab-business]:shadow-[0_2px_8px_rgba(0,0,0,0.18)]
  ">
    <label
      for="ct-overall"
      class="tab tab-overall w-full cursor-pointer rounded-t-xl bg-[#d1d1d1] px-1.5 py-1 text-center text-[11px] font-extrabold leading-tight transition hover:bg-zinc-200 sm:px-3 sm:text-sm"
    >
      <div class="grid h-[80%] place-items-center">
        <span class="grid grid-rows-2 leading-tight">
          <span class="block">{overall.title}</span>
          <span class="block select-none text-transparent" aria-hidden="true">英会話</span>
        </span>
      </div>
    </label>
    <label
      for="ct-daily"
      class="tab tab-daily w-full cursor-pointer rounded-t-xl bg-[#d1d1d1] px-1.5 py-1 text-center text-[11px] font-extrabold leading-tight transition hover:bg-zinc-200 sm:px-3 sm:text-sm"
    >
      <div class="grid h-[80%] place-items-center">
        <span class="grid grid-rows-2 leading-tight">
          <span class="block">日常</span>
          <span class="block">英会話</span>
        </span>
      </div>
    </label>
    <label
      for="ct-business"
      class="tab tab-business w-full cursor-pointer rounded-t-xl bg-[#d1d1d1] px-1.5 py-1 text-center text-[11px] font-extrabold leading-tight transition hover:bg-zinc-200 sm:px-3 sm:text-sm"
    >
      <div class="grid h-[80%] place-items-center">
        <span class="grid grid-rows-2 leading-tight">
          <span class="block">ビジネス</span>
          <span class="block">英会話</span>
        </span>
      </div>
    </label>
  </div>

  <div class="mt-4 hidden peer-checked/ct-overall:block">
    <div class="sm:hidden">
      <CompareTable ranking={oMobile} variant="stack" />
    </div>
    <div class="hidden sm:block">
      <CompareTable ranking={oDesktop} variant="table" />
    </div>
  </div>
  <div class="mt-4 hidden peer-checked/ct-daily:block">
    <div class="sm:hidden">
      <CompareTable ranking={dMobile} variant="stack" />
    </div>
    <div class="hidden sm:block">
      <CompareTable ranking={dDesktop} variant="table" />
    </div>
  </div>
  <div class="mt-4 hidden peer-checked/ct-business:block">
    <div class="sm:hidden">
      <CompareTable ranking={bMobile} variant="stack" />
    </div>
    <div class="hidden sm:block">
      <CompareTable ranking={bDesktop} variant="table" />
    </div>
  </div>
</section>

